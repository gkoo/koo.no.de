var onLinkedInLoad;$(function(){var aA,ae,ap,aS,aL,aE=new Date(),X=aE.getMonth()+1,aR=aE.getFullYear(),aB=0,aw=[],ai=-1,aN={},aF=[],ac=0,ab=0,au=100,aO=$(".pics"),Y=$("#loading"),an=$("#timeline"),Z=$("#mypic"),aQ=$("#message"),at=$("#playBtn"),ar=$("#speed"),af=$("#signin"),aI=$("#logo img"),aG=$("#timelineStuff"),am=an.children(".top.block"),aK=an.children(".bottom.block"),ah=0,ax=0,ak=0,aD=0,aP=8080,ao=80,aq=1,aM=290,ad=126,aa=970,al=140,az=20,aT=20,aj=315,aH=az,ay=az+aa-ao-aq*2,av=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],aC=["orange","blue","green","purple","teal","red","yellow","magenta","grey"],ag=/[^\w\s]/gi,aJ;convertDateToVal=function(a){if(!a){return 0}return(a.year-1900)*12+a.month},convertPxToPct=function(a){if(a<az){a=az}else{if(a>az+aa){a=az+aa}}return a/aa*100},myCareerNow=convertDateToVal({month:X,year:aR}),showErrorMsg=function(a,c,d,e){var b;aG.fadeTo("slow",0);aG.hide();af.fadeTo("slow",0);af.hide();Y.fadeTo("slow",0);Y.hide();if(!a){a="Whoops... we broke something.";c="In the mean time, ";d="check out LinkedIn Today!";e="http://www.linkedin.com/today/"}b=$("<a/>").attr("href",e).text(d);aQ.append($("<p/>").text(a)).append($("<p/>").text(c).append(b));aQ.show();aQ.fadeTo("slow",1)},isSameCompanies=function(b,g){var e,f,d,c=b.length,a=g.length;if(c!==a){return false}for(e=0;e<c;++e){d=false;for(f=0;f<a;++f){if(b[e].name===g[f].name){d=true;break}}if(!d){return false}}return true},hidePic=function(a){a.removeClass("picShowing").removeClass("picToShow").removeClass("picToHide");if(a.hasClass("upper")){a.animate({top:aj+ao+"px"})}else{a.animate({top:ao*(-1.5)+"px"})}},hidePics=function(){aO.children(".picShowing").each(function(){var a=$(this);if(!a.hasClass("picToShow")){hidePic(a)}})},hideMarkedPics=function(){aO.children(".picToHide").each(function(){hidePic($(this))})},showPics=function(){aO.children(".picToShow").each(function(){var a=$(this);a.removeClass("picToShow");if(!a.hasClass("picShowing")){a.addClass("picShowing").animate({top:a.attr("li-top")+"px"})}})},isConcurrentEmployee=function(a){var e,b,f,d=a.length,c=Math.floor(aB);for(e=0;e<d;++e){cxnDate=a[e].split(":");b=parseInt(cxnDate[0],10);f=parseInt(cxnDate[1],10);if((b&&(b<c||b==c))&&(!f||(f>c||f==c))){return true}}return false},showExistingPictures=function(c,d){var b,e,a;if(!c){return}a=c[ai];for(id in c){if(id!==ai){b=$("#"+id);if(b){e=isConcurrentEmployee(c[id]);if(b&&e){b.addClass("picToShow");b.removeClass("picToHide")}else{if(b&&b.hasClass("picShowing")&&!e&&!b.hasClass("picToShow")){b.addClass("picToHide")}}}}}},updateCurrCompanies=function(e){var d,f,b,a,c=aw.length;for(i=0;i<c;++i){b=aw[i];f=b.unformattedName;if(aL[f]){showExistingPictures(aL[f],e)}}hidePics();showPics();companyNames=[];$(".infoBlock").css("opacity",0);for(i=0;i<c;++i){a=convertDateToVal(aw[i].startDate);d=[aw[i].name.toLowerCase(),a].join("").replace(/\s/g,"").replace(ag,"");$("."+d).css("opacity",1)}},doDrag=function(b){var j,l,m,g,d,h,f,k,a,e,c;j=(b-aH)/(ay-aH);c=(au-ab)/100;j=j*c+ab/100;l=(ap*j)+ae;aB=l;f=aw;aw=[];k=aF.length;for(m=0;m<k;++m){g=aF[m];d=convertDateToVal(g.startDate);h=convertDateToVal(g.endDate);if(d&&d<l&&(!h||h>l)){if(g.name){aw.push(g)}}}a=aw.length;if(a&&!isSameCompanies(f,aw)){updateCurrCompanies(aB)}else{if(a){for(m=0;m<a;++m){e=aL[aw[m].unformattedName];if(e){showExistingPictures(e,aB)}}showPics();hideMarkedPics()}}if(!a){$(".infoBlock").css("opacity",0);hidePics()}},doDragWrapper=function(b,a){Z.stop(true);at.text("Play");doDrag(a.position.left)},convertDateToVal=function(a){if(!a){return 0}if(!a.month){a.month=1}return a?(a.year-1900)*12+a.month:0},datesOverlap=function(b,c,a,d){if(!b||!a){return false}if(c&&d){return(c>a&&b<d)}if((!c&&!d)||(c==0&&d==0)){return true}if(!c){return b<d}return a<c},timelineHasRoom=function(d,f,a){var c,e,b=d.length;if(d&&!b){return 1}for(e=0;e<b;++e){c=d[e].split(":");if(datesOverlap(c[0],c[1],f,a)){return false}}return true},addBlockToTimeline=function(b,c,d,a){if(a==="top"){am.append(b);an.children(".top.date").append(c);an.children(".top.info").append(d)}else{aK.append(b);an.children(".bottom.date").append(c);an.children(".bottom.info").append(d)}},createTimelineBlock=function(p,n,c,a){var d,m,k,g,h,q,e,j,l,o,b,f="";d=convertDateToVal(p.startDate);m=p.endDate?convertDateToVal(p.endDate):myCareerNow;width=(m-d)/ap*100+"%";e=Math.floor((d-ae)/ap*100);b=(d-ae)/ap*100+"%";q=aC[n%aC.length];if(p.endDate){f=" - "+av[p.endDate.month-1]+" "+p.endDate.year}j="("+av[p.startDate.month-1]+" "+p.startDate.year+f+")";k=$("<div/>").attr("data-li-left",b).attr("data-li-width",width).addClass(q+" tlBlock").css({height:"100%",width:width,left:b,"z-index":e,position:"absolute","border-left":"1px solid #fff"});g=$("<span/>").text(av[p.startDate.month-1]+" "+p.startDate.year).css({position:"absolute","z-index":e,left:b}).attr("data-li-left",b).attr("data-li-zindex",e);h=$("<span/>").css({left:b,"z-index":e}).attr("data-li-left",b).attr("data-li-zindex",e).addClass("infoBlock").addClass([p.company.name.toLowerCase(),d].join("").replace(/\s/g,"").replace(ag,"")).append($("<span/>").addClass("compName").text(p.company.name)).append($("<span/>").addClass("compDate").text(j));l=timelineHasRoom(c,d,m);o=timelineHasRoom(a,d,m);if((l&&o)||(!l&&!o)){if(n%2){addBlockToTimeline(k,g,h,"top");c.push(d+":"+m)}else{addBlockToTimeline(k,g,h,"bottom");a.push(d+":"+m)}}else{if(l){addBlockToTimeline(k,g,h,"top");c.push(d+":"+m)}else{if(o){addBlockToTimeline(k,g,h,"bottom");a.push(d+":"+m)}}}},handleOwnPositions=function(f){var e,h,g,d,a=[],b=[],c=f.length;an.hide();ae=convertDateToVal(f[0].startDate);for(e=0;e<c;++e){h=f[e];g=h.company;if(g&&g.name){aF.push({id:g.id,name:g.name,unformattedName:g.name.toLowerCase().replace(ag,""),startDate:h.startDate,endDate:h.endDate});d=convertDateToVal(h.startDate);if(d<ae){ae=d}}}ap=myCareerNow-ae;for(e=0;e<c;++e){createTimelineBlock(f[e],e,a,b)}an.show()},addEducationToPositions=function(d){var f,e,a,b,h,c,g;if(d.educations&&d.educations.values){a=d.educations.values;c=a.length;for(f=0;f<c;++f){b=a[f];if(b.startDate){h={company:{name:b.schoolName},startDate:b.startDate,endDate:b.endDate};if(d.positions&&d.positions.values){g=d.positions.values.length;for(e=g-1;e>=0;--e){if(d.positions.values[e].endDate&&(convertDateToVal(d.positions.values[e].endDate)>convertDateToVal(b.endDate))){d.positions.values.splice(e+1,0,h);break}else{if(e===0){d.positions.values.splice(0,0,h)}}}++d.positions._total}else{if(!d.positions){d.positions={}}d.positions._total=1;d.positions.values=[h]}}}}};handleOwnProfile=function(a){var b;if(!a){return showErrorMsg()}if(!ah){aA=a;return}if(!a.positions._total){showErrorMsg("You don't have any companies listed.","Why not ","add some now?","http://www.linkedin.com/profile/edit?trk=li_timeline");return}addEducationToPositions(a);aS.send({type:"storeOwnProfile",profile:a});ai=a.id;if(!a.pictureUrl){a.pictureUrl="/img/icon_no_photo_80x80.png"}b=$("#mypic").attr("src",a.pictureUrl).fadeTo("fast",1);an.fadeTo("fast",1);Z.css("top",(al-ao)/2-aq);Z.draggable({axis:"x",drag:doDragWrapper,containment:"parent"});if(a.positions&&a.positions.values){handleOwnPositions(a.positions.values)}},createEmployDates=function(c){var b,g,a,f,d,e,h={};if(!c.positions||!c.positions.values){return}d=c.positions.values.length;for(e=0;e<c.positions.values.length;++e){g=c.positions.values[e];a=convertDateToVal(g.startDate);f=convertDateToVal(g.endDate);b=g.company.name?g.company.name.toLowerCase().replace(ag,""):"";if(b){if(h[b]){h[b].push(a+":"+f)}else{if(b){h[b]=[a+":"+f]}}}}return h},storeConnection=function(a){var b={};b.id=a.id;b.pictureUrl=a.pictureUrl;b.publicProfileUrl=a.publicProfileUrl;b.fullName=a.firstName+" "+a.lastName;b.employmentDates=createEmployDates(a);aN[a.id]=b},createCxnPic=function(d){var c,a,b,e;c=Math.floor(Math.random()*20)-10;if(!d.publicProfileUrl){d.publicProfileUrl="#"}e=$("<a/>").attr("href",d.publicProfileUrl).attr("title",d.firstName+" "+d.lastName).attr("id",d.id).attr("target","_new").css({"-moz-transform":"rotate("+c+"deg)","-webkit-transform":"rotate("+c+"deg)",transform:"rotate("+c+"deg)",position:"absolute","background-image":"url("+d.pictureUrl+")"}).addClass("cxnPic");e.hover(function(){$(this).css("z-index",1000)},function(){$(this).css("z-index","")});if(Math.floor(Math.random()*2)){if(Math.floor(Math.random()*4)){b=Math.floor(Math.random()*(ay-aM))+aM;a=Math.floor(Math.random()*(aj-ao-30))+10}else{b=Math.floor(Math.random()*(aM));a=Math.floor(Math.random()*(aj-ad-ao*5/4-30))+(ad+aT)}e.addClass("upper").css({top:aj+ao,left:b}).attr("li-top",a);$("#upper .pics").append(e)}else{b=Math.floor(Math.random()*ay);a=Math.floor(Math.random()*(aj-ao-20))+10;e.addClass("lower").css({left:b,top:ao*(-1.5)}).attr("li-top",a);$("#lower .pics").append(e.addClass("lower"))}if(d.id==="8Hnjm5JwNG"){e.click(function(g){var f=$("#gk");g.preventDefault();if(!f.length){f=$("<img>").attr("id","gk").attr("src","/img/gk.jpg");$("body").append(f);f.load(doGKAnimate)}else{f.css("left","-650px");doGKAnimate()}})}},handleConnections=function(d){var c,b,a;ak=1;if(!ax){aN=d;return}if(!d.values||!d._total){showErrorMsg("It doesn't look like you have any connections yet.","Here are some ","people you may know.","http://www.linkedin.com/pymk-results");return}b=d.values.length;for(c=0;c<b;++c){a=d.values[c];if(a.id!==ai&&a.pictureUrl){storeConnection(a);if(!$("#"+a.id).length){createCxnPic(a)}addEducationToPositions(a)}else{}}aS.send({type:"filterConnections",profiles:d,sessionId:ac})},doGKAnimate=function(){var a=$("#gk");a.css("left","-650px").show();a.animate({left:$(window).width()},{complete:function(){a.hide()}})},doPlay=function(){var c,a,b,d,e={slow:25000,med:12000,fast:6000,realfast:2000};$(this).text("Pause");myPicLeft=Z.position().left;b=ar.children(".active");d=b.attr("class").replace(/\s?active\s?/,"");a=e[d];c=(ay-myPicLeft)*a/ay;Z.animate({left:ay+"px"},{duration:c,easing:"linear",step:function(g,f){doDrag(g)},complete:function(){at.text("Play")}})},doPause=function(){$(this).text("Play");Z.stop(stop)},fixOverflow=function(){var b=$(this),c=b.width(),a=b.attr("data-li-left"),d;if(c+b.position().left>aa){d=(aa-c)/aa*100+"%";b.css("left",d).attr("data-li-rawleft",a).attr("data-li-left",d)}},onLinkedInAuth=function(){af.fadeTo("fast",0);af.hide();Y.show();Y.fadeTo("slow",1);aI.show();aI.fadeTo("slow",1);IN.API.Raw("/people/~:(id,first-name,last-name,positions,picture-url,educations)").result(handleOwnProfile);IN.API.Raw("/people/~/connections:(id,first-name,last-name,positions,picture-url,public-profile-url,educations)").result(handleConnections)};onLinkedInLoad=function(){Y.fadeTo("slow",0,function(){Y.children("p:nth-child(1)").text("Loading connections...")});Y.hide();af.show();af.fadeTo("slow",1);IN.Event.on(IN,"auth",onLinkedInAuth)};aS=new io.Socket(null,{port:aP,rememberTransport:false});aS.connect();aS.on("connect",function(){ah=1;if(aA&&!ax){handleOwnProfile(aA)}});aS.on("message",function(a){if(a.type!=="undefined"){if(a.type==="storeOwnProfileComplete"){ac=a.sessionId;ax=1;if(ak){handleConnections(aN)}}else{if(a.type==="filterConnectionsResult"){aD=1;aL=a.coworkers;Y.fadeTo("fast",0);Y.hide();aG.show();aJ=an.offset().top;$("#timeline .date span").each(fixOverflow);$(".infoBlock").each(fixOverflow);aG.fadeTo("slow",1)}}}});at.click(function(a){a.preventDefault();if($(this).text()==="Play"){doPlay.apply(this)}else{doPause.apply(this)}});ar.children().click(function(b){var a=$(this);if(a.hasClass("active")){return b.preventDefault()}ar.children(".hide").removeClass("hide");ar.children(".active").removeClass().addClass(a.attr("class")+" active");ar.find(".active a").text(a.text());a.addClass("hide");ar.removeClass("hover");b.preventDefault()}),ar.hover(function(){ar.addClass("hover")},function(){ar.removeClass("hover")});$("#printCoworkers").click(function(){console.log(aL)});$("#printCompBtn").click(function(){console.log(aF)});setTimeout(function(){var a=Y.find(".helpReload");if(!aD){a.show().click(function(b){window.location.reload();b.preventDefault()})}},45000)});